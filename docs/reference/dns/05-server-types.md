# Типы DNS серверов

В системе DNS существует несколько типов серверов, каждый из которых выполняет свою роль. В этом разделе мы рассмотрим все основные типы.

## Классификация DNS серверов

DNS серверы можно классифицировать по их функции в процессе резолвинга:

1. **Рекурсивный резолвер** (Recursive Resolver)
2. **Корневой DNS сервер** (Root DNS Server)
3. **TLD DNS сервер** (Top-Level Domain Server)
4. **Авторитативный DNS сервер** (Authoritative DNS Server)
5. **Кэширующий DNS сервер** (Caching DNS Server)

## 1. Рекурсивный резолвер (Recursive Resolver)

Также называется "DNS-резолвер" или "DNS-клиент".

### Функции

- Принимает запросы от клиентов
- Выполняет полный процесс резолвинга от имени клиента
- Кэширует ответы для ускорения последующих запросов
- Возвращает окончательный ответ клиенту

### Характеристики

- **Не хранит** информацию о доменах
- **Не является авторитативным** для каких-либо доменов
- Работает как "посредник" между клиентом и авторитативными серверами

### Примеры

- **Google Public DNS:** `8.8.8.8`, `8.8.4.4`
- **Cloudflare DNS:** `1.1.1.1`, `1.0.0.1`
- **OpenDNS:** `208.67.222.222`, `208.67.220.220`
- **DNS серверы провайдеров** (обычно автоматически настраиваются)

### Использование

Клиенты настраивают рекурсивный резолвер как свой DNS сервер. Все DNS запросы идут через этот сервер.

---

## 2. Корневой DNS сервер (Root DNS Server)

Корневые серверы — это основа всей системы DNS.

### Функции

- Хранят информацию о доменах верхнего уровня (TLD)
- Направляют запросы к соответствующим TLD серверам
- Являются отправной точкой для всех DNS запросов

### Характеристики

- **Всего 13 корневых серверов** (буквенно обозначены от A до M)
- Управляются различными организациями по всему миру
- Используют **anycast** для распределения нагрузки
- Физически расположены в разных странах

### Список корневых серверов

| Буква | Доменное имя | Организация |
|-------|--------------|-------------|
| A | a.root-servers.net | Verisign |
| B | b.root-servers.net | USC-ISI |
| C | c.root-servers.net | Cogent Communications |
| D | d.root-servers.net | University of Maryland |
| E | e.root-servers.net | NASA |
| F | f.root-servers.net | Internet Systems Consortium |
| G | g.root-servers.net | US Department of Defense |
| H | h.root-servers.net | US Army Research Lab |
| I | i.root-servers.net | Netnod |
| J | j.root-servers.net | Verisign |
| K | k.root-servers.net | RIPE NCC |
| L | l.root-servers.net | ICANN |
| M | m.root-servers.net | WIDE Project |

### Использование

Рекурсивные резолверы обращаются к корневым серверам, когда не знают, где находится TLD домена.

**RFC:** RFC 1034, RFC 1035

---

## 3. TLD DNS сервер (Top-Level Domain Server)

TLD серверы управляют доменами верхнего уровня.

### Функции

- Хранят информацию о доменах конкретного TLD (например, все `.com` домены)
- Направляют запросы к авторитативным серверам конкретных доменов
- Управляются регистраторами доменов

### Типы TLD

#### gTLD (Generic Top-Level Domain)
- Общие домены: `.com`, `.org`, `.net`, `.info`
- Управляются различными организациями

#### ccTLD (Country Code Top-Level Domain)
- Национальные домены: `.ru`, `.us`, `.uk`, `.de`
- Управляются национальными регистраторами

#### sTLD (Sponsored Top-Level Domain)
- Спонсируемые домены: `.edu`, `.gov`, `.mil`
- Управляются специализированными организациями

### Примеры

- **.com TLD серверы:** `a.gtld-servers.net`, `b.gtld-servers.net`, и т.д.
- **.ru TLD серверы:** `a.dns.ripn.net`, `b.dns.ripn.net`, и т.д.

### Использование

Рекурсивные резолверы обращаются к TLD серверам, чтобы узнать авторитативные серверы для конкретного домена.

**RFC:** RFC 1034, RFC 1035

---

## 4. Авторитативный DNS сервер (Authoritative DNS Server)

Авторитативные серверы хранят окончательную информацию о конкретных доменах.

### Функции

- Хранят DNS записи для доменов
- Отвечают на запросы о доменах, за которые они ответственны
- Являются **источником истины** для домена

### Типы авторитативных серверов

#### Первичный сервер (Primary/Master Server)
- Хранит основную копию DNS зоны
- Администратор вносит изменения на этом сервере
- Также называется "мастер-сервер"

#### Вторичный сервер (Secondary/Slave Server)
- Хранит копию DNS зоны с первичного сервера
- Синхронизируется через зонные трансферы (AXFR/IXFR)
- Обеспечивает отказоустойчивость и распределение нагрузки

### Характеристики

- **Авторитативен** для определенных доменов
- **Не выполняет рекурсию** (обычно)
- Может отвечать на запросы о доменах, за которые не отвечает (но не авторитативно)

### Примеры

- **ns1.example.com** — авторитативный сервер для домена `example.com`
- **ns1.google.com** — авторитативный сервер для домена `google.com`

### Использование

Когда рекурсивный резолвер узнает авторитативный сервер для домена, он обращается напрямую к нему за окончательным ответом.

**RFC:** RFC 1034, RFC 1035

---

## 5. Кэширующий DNS сервер (Caching DNS Server)

Кэширующий сервер — это рекурсивный резолвер, который дополнительно оптимизирован для кэширования.

### Функции

- Кэширует DNS ответы
- Уменьшает нагрузку на авторитативные серверы
- Ускоряет ответы для повторяющихся запросов

### Характеристики

- Может быть отдельным сервером или частью рекурсивного резолвера
- Использует TTL для управления временем жизни кэша
- Может кэшировать как положительные, так и отрицательные ответы

### Использование

Обычно используется в корпоративных сетях или провайдерами для ускорения DNS запросов.

---

## Специальные типы серверов

### Forwarding DNS Server

Сервер, который перенаправляет все запросы другому DNS серверу (обычно рекурсивному резолверу).

**Использование:**
- В корпоративных сетях для централизованного управления
- Для фильтрации и логирования DNS запросов

### Split-Horizon DNS

Сервер, который возвращает разные ответы в зависимости от источника запроса.

**Использование:**
- Разные ответы для внутренней и внешней сети
- Географическая маршрутизация

### DNS Proxy

Прокси-сервер, который перехватывает DNS запросы и перенаправляет их другим серверам.

**Использование:**
- Фильтрация и блокировка нежелательных доменов
- Логирование и мониторинг
- Балансировка нагрузки

---

## Взаимодействие серверов

### Пример полного процесса

```
1. Клиент → Рекурсивный резолвер
   "Где находится www.example.com?"

2. Рекурсивный резолвер → Корневой сервер
   "Где находится .com?"

3. Корневой сервер → Рекурсивный резолвер
   "Спроси TLD сервер для .com"

4. Рекурсивный резолвер → TLD сервер (.com)
   "Где находится example.com?"

5. TLD сервер → Рекурсивный резолвер
   "Спроси авторитативный сервер example.com"

6. Рекурсивный резолвер → Авторитативный сервер
   "Где находится www.example.com?"

7. Авторитативный сервер → Рекурсивный резолвер
   "93.184.216.34"

8. Рекурсивный резолвер → Клиент
   "93.184.216.34" (кэширует ответ)
```

## Выбор DNS сервера

### Для клиентов

Обычно используется рекурсивный резолвер:
- Провайдера (автоматически)
- Публичного DNS (Google, Cloudflare)
- Корпоративного DNS сервера

### Для доменов

Используются авторитативные серверы:
- Предоставляемые регистратором домена
- Собственные серверы
- Услуги DNS хостинга (Cloudflare, AWS Route 53)

## Безопасность DNS серверов

### DNSSEC

Расширение DNS для криптографической подписи записей, защищающее от подделки ответов.

**RFC:** RFC 4033, RFC 4034, RFC 4035

### DoH (DNS over HTTPS)

DNS запросы через HTTPS для защиты от перехвата и модификации.

**RFC:** RFC 8484

### DoT (DNS over TLS)

DNS запросы через TLS для шифрования трафика.

**RFC:** RFC 7858

## Ссылки на RFC

- **RFC 1034** — Domain Names — Concepts and Facilities — концепции серверов
- **RFC 1035** — Domain Names — Implementation and Specification — технические детали
- **RFC 4033** — DNS Security Introduction and Requirements (DNSSEC)
- **RFC 7858** — Specification for DNS over Transport Layer Security (DoT)
- **RFC 8484** — DNS Queries over HTTPS (DoH)

## Следующие шаги

Теперь, когда вы понимаете типы серверов, изучите:
- [DNS коды ответов](06-response-codes.md) — что означают различные ответы серверов
- [Процесс резолвинга DNS](04-resolution-process.md) — как серверы взаимодействуют
