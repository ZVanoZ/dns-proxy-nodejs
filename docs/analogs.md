# Аналоги DNS-прокси с поддержкой масок и цепочек DNS

Список приложений с открытым исходным кодом, поддерживающих:
- **Маски DNS** (wildcard routing, например `*.company.local`)
- **Цепочки DNS** (upstream DNS chains с fallback)

---

## Приложения, компилируемые в бинарный файл

### 1. **dnsmasq**
- **Язык**: C
- **Лицензия**: GPL v2/v3
- **Репозиторий**: https://thekelleys.org.uk/dnsmasq/
- **Поддержка масок**: ✅ Частичная (через `server=/domain/` для конкретных доменов, но не полноценные wildcard маски)
- **Поддержка цепочек**: ✅ Да (несколько `server=` для одного домена)
- **Особенности**: 
  - Легковесный DNS/DHCP сервер
  - Широко используется в Linux
  - Простая конфигурация
  - Поддержка локального hosts файла
- **Пример конфигурации**:
  ```
  server=/company.local/10.10.10.1
  server=/company.local/10.10.11.13
  server=1.1.1.1
  ```

### 2. **CoreDNS**
- **Язык**: Go
- **Лицензия**: Apache 2.0
- **Репозиторий**: https://github.com/coredns/coredns
- **Поддержка масок**: ✅ Да (через плагин `hosts` с wildcard и `template`)
- **Поддержка цепочек**: ✅ Да (плагин `forward` с несколькими upstream серверами)
- **Особенности**:
  - Модульная архитектура с плагинами
  - Используется в Kubernetes
  - Высокая производительность
  - Гибкая конфигурация через Corefile
- **Пример конфигурации**:
  ```
  hosts {
    *.company.local 192.168.1.1
    fallthrough
  }
  forward .company.local 10.10.10.1 10.10.11.13 {
    max_fails 3
    health_check 5s
  }
  forward . 1.1.1.1 8.8.8.8
  ```

### 3. **Unbound**
- **Язык**: C
- **Лицензия**: BSD
- **Репозиторий**: https://github.com/NLnetLabs/unbound
- **Поддержка масок**: ✅ Частичная (через `forward-zone` для конкретных доменов)
- **Поддержка цепочек**: ✅ Да (несколько серверов в `forward-zone`)
- **Особенности**:
  - Рекурсивный DNS-резолвер
  - Поддержка DNSSEC
  - Высокая производительность
  - Безопасность
- **Пример конфигурации**:
  ```
  forward-zone:
    name: "company.local"
    forward-addr: 10.10.10.1@53
    forward-addr: 10.10.11.13@53
  forward-zone:
    name: "."
    forward-addr: 1.1.1.1@53
  ```

### 4. **AdGuard Home**
- **Язык**: Go
- **Лицензия**: GPL v3
- **Репозиторий**: https://github.com/AdguardTeam/AdGuardHome
- **Поддержка масок**: ✅ Да (через условное форвардинг доменов)
- **Поддержка цепочек**: ✅ Да (несколько upstream серверов)
- **Особенности**:
  - DNS-сервер с блокировкой рекламы
  - Веб-интерфейс для управления
  - Поддержка фильтров
  - Условное форвардинг по доменам
- **Конфигурация**: Через веб-интерфейс или YAML файл

### 5. **SmartDNS**
- **Язык**: C
- **Лицензия**: GPL v3
- **Репозиторий**: https://github.com/pymumu/smartdns
- **Поддержка масок**: ✅ Да (условное форвардинг по доменам)
- **Поддержка цепочек**: ✅ Да (несколько upstream серверов с приоритетами)
- **Особенности**:
  - Специализированный DNS-прокси
  - Поддержка условного форвардинга
  - Выбор лучшего DNS-сервера
  - Поддержка DoH/DoT
- **Пример конфигурации**:
  ```
  server-name company-dns
  server 10.10.10.1 -group company-dns
  server 10.10.11.13 -group company-dns
  domain-rule /company.local/ -nameserver company-dns
  server 1.1.1.1
  ```

### 6. **PowerDNS Recursor**
- **Язык**: C++
- **Лицензия**: GPL v2
- **Репозиторий**: https://github.com/PowerDNS/pdns
- **Поддержка масок**: ✅ Да (через `forward-zones` и `forward-zones-recurse`)
- **Поддержка цепочек**: ✅ Да (несколько серверов для зоны)
- **Особенности**:
  - Высокопроизводительный рекурсивный резолвер
  - Поддержка Lua скриптов
  - Гибкая конфигурация
- **Пример конфигурации**:
  ```
  forward-zones=company.local=10.10.10.1;10.10.11.13
  forward-zones-recurse=.=1.1.1.1
  ```

### 7. **Knot Resolver**
- **Язык**: C, Lua
- **Лицензия**: GPL v3
- **Репозиторий**: https://gitlab.nic.cz/knot/knot-resolver
- **Поддержка масок**: ✅ Да (через Lua политики)
- **Поддержка цепочек**: ✅ Да (через политики маршрутизации)
- **Особенности**:
  - Модульный рекурсивный резолвер
  - Поддержка Lua для кастомной логики
  - Высокая производительность
  - Поддержка DNSSEC
- **Конфигурация**: Через Lua скрипты

### 8. **BIND (named)**
- **Язык**: C
- **Лицензия**: MPL 2.0
- **Репозиторий**: https://gitlab.isc.org/isc-projects/bind9
- **Поддержка масок**: ✅ Да (через `forwarders` и `forward` зоны)
- **Поддержка цепочек**: ✅ Да (несколько forwarders)
- **Особенности**:
  - Классический DNS-сервер
  - Очень гибкая конфигурация
  - Поддержка всех функций DNS
  - Сложная настройка
- **Пример конфигурации**:
  ```
  zone "company.local" {
    type forward;
    forwarders { 10.10.10.1; 10.10.11.13; };
  };
  ```

### 9. **mosdns**
- **Язык**: Go
- **Лицензия**: GPL v3
- **Репозиторий**: https://github.com/IrineSistiana/mosdns
- **Поддержка масок**: ✅ Да (через правила маршрутизации)
- **Поддержка цепочек**: ✅ Да (несколько upstream серверов)
- **Особенности**:
  - Легковесный DNS-прокси
  - Поддержка DoH/DoT
  - Гибкая маршрутизация
  - Поддержка гео-маршрутизации
- **Конфигурация**: YAML файл

### 10. **dnscrypt-proxy**
- **Язык**: Go
- **Лицензия**: ISC
- **Репозиторий**: https://github.com/DNSCrypt/dnscrypt-proxy
- **Поддержка масок**: ⚠️ Ограниченная (через `cloaking_rules`)
- **Поддержка цепочек**: ✅ Да (несколько upstream серверов)
- **Особенности**:
  - Фокус на шифровании DNS (DNSCrypt, DoH, DoT)
  - Блокировка рекламы
  - Ограниченная поддержка условного форвардинга

---

## Интерпретируемые приложения (не компилируются в бинарник)

### 11. **dns-proxy-nodejs** (ваше приложение)
- **Язык**: TypeScript/Node.js
- **Лицензия**: ISC
- **Поддержка масок**: ✅ Да (полная поддержка wildcard масок)
- **Поддержка цепочек**: ✅ Да (несколько upstream серверов с fallback)
- **Особенности**:
  - Простая конфигурация через INI файл
  - Легко расширять
  - Подходит для разработки

### 12. **dns-proxy** (npm пакет)
- **Язык**: JavaScript/Node.js
- **Репозиторий**: https://www.npmjs.com/package/dns-proxy
- **Поддержка масок**: ⚠️ Ограниченная
- **Поддержка цепочек**: ⚠️ Ограниченная
- **Особенности**: Простой DNS-прокси для базовых задач

### 13. **Python DNS серверы**
- **dnspython**, **pydns** и другие
- **Поддержка масок**: ⚠️ Зависит от реализации
- **Поддержка цепочек**: ⚠️ Зависит от реализации
- **Особенности**: Обычно используются для разработки и тестирования

---

## Сравнительная таблица

| Приложение | Язык | Компилируется | Маски DNS | Цепочки DNS | Сложность настройки |
|------------|------|---------------|-----------|-------------|---------------------|
| dnsmasq | C | ✅ | ⚠️ Частично | ✅ | Низкая |
| CoreDNS | Go | ✅ | ✅ | ✅ | Средняя |
| Unbound | C | ✅ | ⚠️ Частично | ✅ | Средняя |
| AdGuard Home | Go | ✅ | ✅ | ✅ | Низкая |
| SmartDNS | C | ✅ | ✅ | ✅ | Средняя |
| PowerDNS Recursor | C++ | ✅ | ✅ | ✅ | Средняя |
| Knot Resolver | C/Lua | ✅ | ✅ | ✅ | Высокая |
| BIND | C | ✅ | ✅ | ✅ | Высокая |
| mosdns | Go | ✅ | ✅ | ✅ | Средняя |
| dnscrypt-proxy | Go | ✅ | ⚠️ Ограничено | ✅ | Средняя |
| **dns-proxy-nodejs** | **TS/Node.js** | ❌ | ✅ | ✅ | **Низкая** |

---

## Рекомендации

### Для разработки:
- **dns-proxy-nodejs** (ваше приложение) - простота и гибкость
- **dnsmasq** - легковесный и быстрый

### Для продакшена:
- **CoreDNS** - модульность и производительность
- **SmartDNS** - специализация на условном форвардинге
- **Unbound** - безопасность и DNSSEC

### Для сложных сценариев:
- **BIND** - максимальная гибкость
- **Knot Resolver** - Lua скрипты для кастомной логики

---

## Примечания

- **Маски DNS**: Поддержка wildcard паттернов типа `*.company.local`
- **Цепочки DNS**: Несколько upstream серверов с автоматическим fallback при недоступности
- Большинство решений поддерживают условное форвардинг (conditional forwarding), но не все имеют полноценную поддержку wildcard масок
- Ваше приложение выделяется простотой конфигурации и поддержкой масок в удобном формате
