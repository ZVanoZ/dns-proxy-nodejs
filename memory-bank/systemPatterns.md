# Memory Bank: System Patterns

## Архитектурные паттерны

### Модульная структура
Проект организован в модули:
- `App/` - основная логика приложения
- `Logger/` - система логирования
- `Test/` - тестовые утилиты

### Загрузка конфигурации
- Конфигурация загружается из INI файлов через `OptionsLoader`
- Поддержка различных окружений (DEV/PROD)
- Настройка через `config/app.ini`

### Инициализация приложения
```typescript
1. Создание Logger через LoggerFactory
2. Создание экземпляра App
3. Загрузка опций из INI файла
4. Установка опций в App
5. Запуск приложения
```

### Логирование
- Фабрика логгеров (`LoggerFactory`)
- Ротация логов (`LogRotationService`)
- Форматирование логов (`LogFormatter`)
- Переупорядочивание потоков (`LogReorderStream`)

### Обработка ошибок
- Асинхронная инициализация с обработкой ошибок
- Выход из процесса при критических ошибках
- Логирование ошибок через структурированный логгер

## Паттерны проектирования

### Factory Pattern
- `LoggerFactory` - создание экземпляров логгеров
- `OptionsLoader` - загрузка конфигурации

### Service Pattern
- `LogRotationService` - сервис ротации логов
- `App` - основной сервис приложения

### Stream Pattern
- `LogReorderStream` - обработка потоков логов

## Принципы разработки

### Объектно-Ориентированное Программирование (ООП)
- **Основной подход** для всего кода приложения
- Использование классов для организации логики:
  - `App` - основной класс приложения
  - `LoggerFactory` - фабрика для создания логгеров
  - `RotatingLogger` - класс для ротации логов
  - `LogRotationService` - сервис ротации
  - `Options` - класс конфигурации
  - `OptionsLoader` - загрузчик конфигурации
- Инкапсуляция через модификаторы доступа (`protected`, `private`, `public`)
- **Исключение**: Unit-тесты используют функциональный подход через Jest (стандартная практика)

### Строгая типизация (ОБЯЗАТЕЛЬНОЕ ТРЕБОВАНИЕ)
- **Использование строгой типизации обязательно** во всех `*.ts` файлах проекта
- Использование TypeScript strict mode
- Все переменные, параметры функций и возвращаемые значения должны иметь явные типы
- Запрещено использование `any` без явной необходимости и обоснования
- Использование `unknown` вместо `any` при необходимости работы с неизвестными типами
- Дополнительные строгие проверки:
  - Проверка индексов массивов (noUncheckedIndexedAccess)
  - Точные опциональные типы (exactOptionalPropertyTypes)

### Модульность
- Разделение ответственности между модулями
- Четкие интерфейсы между компонентами
- ESM модули (import/export)

### Конфигурируемость
- Настройка через внешние файлы
- Поддержка различных окружений (DEV/PROD)
