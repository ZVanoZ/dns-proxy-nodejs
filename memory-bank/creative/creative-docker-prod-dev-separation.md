# Creative Phase: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è PROD –∏ DEV —Ä–µ–∂–∏–º–æ–≤

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2026-01-16  
**–¢–∏–ø:** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ  
**–°—Ç–∞—Ç—É—Å:** üé® CREATIVE PHASE

---

## üé®üé®üé® ENTERING CREATIVE PHASE: ARCHITECTURE

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

#### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
1. **PROD —Ä–µ–∂–∏–º:**
   - –ë–∏–Ω–¥–∏—Ç—å –ø–æ—Ä—Ç 53 –Ω–∞ —Ö–æ—Å—Ç-–º–∞—à–∏–Ω–µ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π DNS –ø–æ—Ä—Ç)
   - –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞–ø–∫—É `./docker/prod/logs/` –≤ `/app/logs`
   - –†–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π DNS-–ø—Ä–æ–∫—Å–∏ —Å–µ—Ä–≤–µ—Ä

2. **DEV —Ä–µ–∂–∏–º:**
   - –ë–∏–Ω–¥–∏—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Ä—Ç 53 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–∞ –≤–Ω–µ—à–Ω–∏–π –ø–æ—Ä—Ç 5053 —Ö–æ—Å—Ç–∞
   - –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞–ø–∫—É `./docker/dev/logs/` –≤ `/app/logs`
   - –ü–æ–∑–≤–æ–ª—è—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å PROD

3. **–û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞:**
   - PROD –∏ DEV –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
   - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ (–ø–æ—Ä—Ç—ã, –ª–æ–≥–∏, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)

#### –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (–ù–û–í–´–ï)
1. **–£–ø—Ä–æ—â–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:**
   - –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª—ã `docker-compose.dev.yml` –∏ `docker-compose.prod.yml`
   - –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ `docker-compose.yml` —Å –ø—Ä–æ—Ñ–∏–ª—è–º–∏

2. **–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è Docker —Ñ–∞–π–ª–æ–≤:**
   - –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å `Dockerfile` ‚Üí `./docker/prod/Dockerfile`
   - –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å `Dockerfile.dev` ‚Üí `./docker/dev/Dockerfile`
   - –õ–æ–≥–∏ –≤ —Å—É–±–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ö —Ä–µ–∂–∏–º–æ–≤: `./docker/prod/logs/` –∏ `./docker/dev/logs/`

#### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –ü–æ—Ä—Ç 53 —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π `NET_BIND_SERVICE` (Linux capability)
- DNS —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ UDP –ø—Ä–æ—Ç–æ–∫–æ–ª—É
- –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `network_mode: host` –¥–ª—è –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–æ–≤
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `config/app.ini` (–ø–æ—Ä—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 53 –≤ –∫–æ–¥–µ, 5053 –≤ –∫–æ–Ω—Ñ–∏–≥–µ)

#### –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Docker Compose —Å –ø—Ä–æ—Ñ–∏–ª—è–º–∏ (`dev` –∏ `prod`)
- PROD –∏—Å–ø–æ–ª—å–∑—É–µ—Ç multi-stage build (Dockerfile)
- DEV –∏—Å–ø–æ–ª—å–∑—É–µ—Ç development build (Dockerfile.dev)
- –û–±–∞ –æ–±—Ä–∞–∑–∞ –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ `node:20.17-alpine`

---

## –ê–Ω–∞–ª–∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
1. **PROD:** `network_mode: host` + –ø–æ—Ä—Ç 53 + `./volume/prod/logs/`
2. **DEV:** bridge network + –ø–æ—Ä—Ç 53‚Üí5053 + `./volume/dev/logs/`

### –ü–ª—é—Å—ã –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è
‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏** - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏  
‚úÖ **–ò–∑–æ–ª—è—Ü–∏—è DEV** - DEV –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π, —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º –ø–æ—Ä—Ç—É  
‚úÖ **PROD –æ—Å—Ç–∞–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π DNS –ø–æ—Ä—Ç 53  
‚úÖ **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–æ–≤** - —á–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–æ–≤ –ø–æ —Ä–µ–∂–∏–º–∞–º  
‚úÖ **–û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞** - –Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø–æ—Ä—Ç–æ–≤ –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏  

### –ú–∏–Ω—É—Å—ã –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è
‚ùå **–†–∞–∑–Ω—ã–µ —Å–µ—Ç–µ–≤—ã–µ —Ä–µ–∂–∏–º—ã** - PROD –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `host`, DEV –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `bridge` (—Ä–∞–∑–Ω–∞—è —Å–µ—Ç–µ–≤–∞—è –∏–∑–æ–ª—è—Ü–∏—è)  
‚ùå **–†–∞–∑–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ç–∏** - –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Ä–∞–∑–ª–∏—á–∏—è–º –≤ –ø–æ–≤–µ–¥–µ–Ω–∏–∏  
‚ùå **–¢—Ä–µ–±—É–µ—Ç –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π –¥–ª—è PROD** - –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ `cap_add: NET_BIND_SERVICE`  
‚ùå **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å firewall** - –ø—Ä–∏ `network_mode: host` –æ–±—Ö–æ–¥—è—Ç—Å—è –ø—Ä–∞–≤–∏–ª–∞ Docker firewall  

---

## –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—à–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- PROD: `network_mode: host` + –ø–æ—Ä—Ç 53 + `cap_add: NET_BIND_SERVICE`
- DEV: bridge network + –ø–æ—Ä—Ç mapping `53:5053` + –±–µ–∑ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```yaml
# docker-compose.yml
services:
  dns-proxy-prod:
    profiles: [prod]
    network_mode: host
    volumes:
      - ./volume/prod/logs:/app/logs
    cap_add:
      - NET_BIND_SERVICE

  dns-proxy-dev:
    profiles: [dev]
    ports:
      - "5053:53/udp"
    volumes:
      - ./volume/dev/logs:/app/logs
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- ‚úÖ PROD —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º –ø–æ—Ä—Ç—É
- ‚úÖ DEV –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π
- ‚úÖ –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –†–∞–∑–Ω—ã–µ —Å–µ—Ç–µ–≤—ã–µ —Ä–µ–∂–∏–º—ã (host vs bridge)
- ‚ùå PROD —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π
- ‚ùå –†–∞–∑–Ω–æ–µ —Å–µ—Ç–µ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

**–û—Ü–µ–Ω–∫–∞:** ‚≠ê‚≠ê‚≠ê‚≠ê (4/5)

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: Bridge network –¥–ª—è –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–æ–≤

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- PROD: bridge network + –ø–æ—Ä—Ç mapping `53:53` + `cap_add: NET_BIND_SERVICE`
- DEV: bridge network + –ø–æ—Ä—Ç mapping `53:5053` + –±–µ–∑ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```yaml
# docker-compose.yml
services:
  dns-proxy-prod:
    profiles: [prod]
    ports:
      - "53:53/udp"
    volumes:
      - ./volume/prod/logs:/app/logs
    cap_add:
      - NET_BIND_SERVICE

  dns-proxy-dev:
    profiles: [dev]
    ports:
      - "5053:53/udp"
    volumes:
      - ./volume/dev/logs:/app/logs
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ï–¥–∏–Ω—ã–π —Å–µ—Ç–µ–≤–æ–π —Ä–µ–∂–∏–º –¥–ª—è –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–æ–≤
- ‚úÖ –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Å–µ—Ç–µ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
- ‚úÖ –ò–∑–æ–ª—è—Ü–∏—è —á–µ—Ä–µ–∑ Docker network
- ‚úÖ –õ–µ–≥—á–µ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å —Å–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå PROD –≤—Å–µ —Ä–∞–≤–Ω–æ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π –¥–ª—è –ø–æ—Ä—Ç–∞ 53
- ‚ùå –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å —Å–µ—Ç–µ–≤–æ–π –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ (–º–æ–∂–µ—Ç –≤–ª–∏—è—Ç—å –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
- ‚ùå –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å firewall –ø—Ä–∞–≤–∏–ª–∞–º–∏

**–û—Ü–µ–Ω–∫–∞:** ‚≠ê‚≠ê‚≠ê‚≠ê (4/5)

---

### –í–∞—Ä–∏–∞–Ω—Ç 3: –û—Ç–¥–µ–ª—å–Ω—ã–µ docker-compose —Ñ–∞–π–ª—ã

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã: `docker-compose.prod.yml` –∏ `docker-compose.dev.yml`
- –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–∑–∞–≤–∏—Å–∏–º
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—â–∏–π `docker-compose.yml` —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–±—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```yaml
# docker-compose.prod.yml
services:
  dns-proxy-prod:
    network_mode: host
    volumes:
      - ./volume/prod/logs:/app/logs
    cap_add:
      - NET_BIND_SERVICE

# docker-compose.dev.yml
services:
  dns-proxy-dev:
    ports:
      - "5053:53/udp"
    volumes:
      - ./volume/dev/logs:/app/logs
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
- ‚úÖ –õ–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ä–µ–∂–∏–º—ã
- ‚úÖ –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏
- ‚úÖ –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –æ–±—Ä–∞–∑–æ–≤

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚ùå –°–ª–æ–∂–Ω–µ–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
- ‚ùå –ë–æ–ª—å—à–µ —Ñ–∞–π–ª–æ–≤ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–û—Ü–µ–Ω–∫–∞:** ‚≠ê‚≠ê‚≠ê (3/5)

---

### –í–∞—Ä–∏–∞–Ω—Ç 4: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—Ä—Ç–æ–≤ –∏ –ø—É—Ç–µ–π
- –ï–¥–∏–Ω—ã–π docker-compose —Ñ–∞–π–ª —Å —É—Å–ª–æ–≤–Ω–æ–π –ª–æ–≥–∏–∫–æ–π
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ `.env` —Ñ–∞–π–ª—ã

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```yaml
# docker-compose.yml
services:
  dns-proxy-prod:
    profiles: [prod]
    network_mode: ${PROD_NETWORK_MODE:-host}
    ports:
      - "${PROD_HOST_PORT:-53}:${PROD_CONTAINER_PORT:-53}/udp"
    volumes:
      - ${PROD_LOGS_PATH:-./volume/prod/logs}:/app/logs
    cap_add:
      - NET_BIND_SERVICE
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ì–∏–±–∫–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚úÖ –ï–¥–∏–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ –õ–µ–≥–∫–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –°–ª–æ–∂–Ω–µ–µ –ø–æ–Ω—è—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- ‚ùå –¢—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- ‚ùå –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

**–û—Ü–µ–Ω–∫–∞:** ‚≠ê‚≠ê‚≠ê (3/5)

---

## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –í—ã–±–æ—Ä: –í–∞—Ä–∏–∞–Ω—Ç 1 (–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ) —Å —É–ª—É—á—à–µ–Ω–∏—è–º–∏

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
1. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** - –ø—Ä–æ—â–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å
2. **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º** - –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
3. **–ü—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å** - PROD –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º –ø–æ—Ä—Ç—É, DEV –Ω–∞ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º
4. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–æ–≤** - —á–µ—Ç–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫

**–£–ª—É—á—à–µ–Ω–∏—è:**
1. –î–æ–±–∞–≤–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –¥–ª—è –ª–æ–≥–æ–≤ –≤ `.gitignore`
2. –î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
3. –û–±–Ω–æ–≤–∏—Ç—å npm —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∑–∞–ø—É—Å–∫–∞
4. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–æ—Ä—Ç–æ–≤ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

---

## –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π (–û–ë–ù–û–í–õ–ï–ù–û)
```
project/
‚îú‚îÄ‚îÄ docker/
‚îÇ   ‚îú‚îÄ‚îÄ prod/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logs/
‚îÇ   ‚îî‚îÄ‚îÄ dev/
‚îÇ       ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ       ‚îî‚îÄ‚îÄ logs/
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ docker-compose.dev.yml      # –£–î–ê–õ–ò–¢–¨
‚îî‚îÄ‚îÄ docker-compose.prod.yml     # –£–î–ê–õ–ò–¢–¨
```

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ docker-compose.yml (–û–ë–ù–û–í–õ–ï–ù–û)

**PROD —Å–µ—Ä–≤–∏—Å:**
```yaml
dns-proxy-prod:
  profiles: [prod]
  build:
    context: .                    # –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–±–æ—Ä–∫–∏ - –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞
    dockerfile: ./docker/prod/Dockerfile
  network_mode: host
  volumes:
    - ./docker/prod/logs:/app/logs
  cap_add:
    - NET_BIND_SERVICE
```

**DEV —Å–µ—Ä–≤–∏—Å:**
```yaml
dns-proxy-dev:
  profiles: [dev]
  build:
    context: .                   # –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–±–æ—Ä–∫–∏ - –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞
    dockerfile: ./docker/dev/Dockerfile
  ports:
    - "5053:53/udp"
  volumes:
    - ./docker/dev/logs:/app/logs
  # cap_add –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
```

**–í–∞–∂–Ω–æ:** 
- `context: .` –æ—Å—Ç–∞–µ—Ç—Å—è –∫–æ—Ä–Ω–µ–º –ø—Ä–æ–µ–∫—Ç–∞, —Ç–∞–∫ –∫–∞–∫ Dockerfile –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `COPY . .` –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
- `dockerfile:` —É–∫–∞–∑—ã–≤–∞–µ—Ç –ø—É—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ context

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ npm —Å–∫—Ä–∏–ø—Ç–æ–≤ (–û–ë–ù–û–í–õ–ï–ù–û)

**–£–¥–∞–ª–∏—Ç—å —Å–∫—Ä–∏–ø—Ç—ã:**
- `docker:dev:separate` - –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω (docker-compose.dev.yml —É–¥–∞–ª–µ–Ω)
- `docker:prod:separate` - –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω (docker-compose.prod.yml —É–¥–∞–ª–µ–Ω)

**–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:**
```json
{
  "docker:prod": "docker compose --profile prod up dns-proxy-prod",
  "docker:dev": "docker compose --profile dev up dns-proxy-dev",
  "docker:both": "docker compose --profile prod --profile dev up",
  "docker:build": "docker compose --profile prod build dns-proxy-prod",
  "docker:build:dev": "docker compose --profile dev build dns-proxy-dev"
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π (–û–ë–ù–û–í–õ–ï–ù–û)
- ‚úÖ PROD –±–∏–Ω–¥–∏—Ç –ø–æ—Ä—Ç 53 –Ω–∞ —Ö–æ—Å—Ç-–º–∞—à–∏–Ω–µ
- ‚úÖ PROD –º–æ–Ω—Ç–∏—Ä—É–µ—Ç `./docker/prod/logs/` –≤ `/app/logs`
- ‚úÖ DEV –±–∏–Ω–¥–∏—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Ä—Ç 53 –Ω–∞ –≤–Ω–µ—à–Ω–∏–π 5053
- ‚úÖ DEV –º–æ–Ω—Ç–∏—Ä—É–µ—Ç `./docker/dev/logs/` –≤ `/app/logs`
- ‚úÖ –û–±–∞ —Ä–µ–∂–∏–º–∞ –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã `docker-compose.dev.yml` –∏ `docker-compose.prod.yml`
- ‚úÖ Dockerfile —Ñ–∞–π–ª—ã –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –≤ `./docker/prod/` –∏ `./docker/dev/`

---

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ iptables –¥–ª—è –ø—Ä–æ–±—Ä–æ—Å–∞ –ø–æ—Ä—Ç–æ–≤
–í–º–µ—Å—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å iptables –¥–ª—è –ø—Ä–æ–±—Ä–æ—Å–∞ –ø–æ—Ä—Ç–∞ 53 –Ω–∞ 5053 –≤ DEV —Ä–µ–∂–∏–º–µ. –û–¥–Ω–∞–∫–æ —ç—Ç–æ:
- ‚ùå –¢—Ä–µ–±—É–µ—Ç root –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π
- ‚ùå –£—Å–ª–æ–∂–Ω—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É
- ‚ùå –ú–µ–Ω–µ–µ –ø–µ—Ä–µ–Ω–æ—Å–∏–º–æ –º–µ–∂–¥—É —Å–∏—Å—Ç–µ–º–∞–º–∏

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ systemd –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å systemd –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è PROD –∏ DEV –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏. –û–¥–Ω–∞–∫–æ —ç—Ç–æ:
- ‚ùå –¢—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚ùå –ú–µ–Ω–µ–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–æ
- ‚ùå –°–ª–æ–∂–Ω–µ–µ —É–ø—Ä–∞–≤–ª—è—Ç—å —á–µ—Ä–µ–∑ Docker

---

## –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

### –†–∏—Å–∫ 1: –ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ—Ä—Ç–æ–≤
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ï—Å–ª–∏ PROD —É–∂–µ –∑–∞–ø—É—â–µ–Ω, DEV –Ω–µ —Å–º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Ä—Ç 53  
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** DEV –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ä—Ç 5053, –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –Ω–µ—Ç

### –†–∏—Å–∫ 2: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π –¥–ª—è PROD
**–û–ø–∏—Å–∞–Ω–∏–µ:** PROD —Ç—Ä–µ–±—É–µ—Ç `NET_BIND_SERVICE` –¥–ª—è –ø–æ—Ä—Ç–∞ 53  
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –£–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ `cap_add`

### –†–∏—Å–∫ 3: –†–∞–∑–Ω—ã–µ —Å–µ—Ç–µ–≤—ã–µ —Ä–µ–∂–∏–º—ã
**–û–ø–∏—Å–∞–Ω–∏–µ:** PROD –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `host`, DEV –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `bridge`  
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –≠—Ç–æ –æ–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º

### –†–∏—Å–∫ 4: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –¥–ª—è –ª–æ–≥–æ–≤
**–û–ø–∏—Å–∞–Ω–∏–µ:** –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `./volume/prod/logs/` –∏ `./volume/dev/logs/` –º–æ–≥—É—Ç –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å  
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** Docker —Å–æ–∑–¥–∞—Å—Ç –∏—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏, –Ω–æ –ª—É—á—à–µ –¥–æ–±–∞–≤–∏—Ç—å –≤ `.gitignore`

---

## –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞ (–û–ë–ù–û–í–õ–ï–ù–û)

- ‚úÖ PROD –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 53 –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ DEV –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 5053 –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –û–±–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- ‚úÖ –õ–æ–≥–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –ø–æ –ø–∞–ø–∫–∞–º `docker/prod/logs/` –∏ `docker/dev/logs/`
- ‚úÖ –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø–æ—Ä—Ç–æ–≤
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤ –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–∞—Ö
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã `docker-compose.dev.yml` –∏ `docker-compose.prod.yml`
- ‚úÖ Dockerfile —Ñ–∞–π–ª—ã –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω—ã –≤ `docker/prod/` –∏ `docker/dev/`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

## –ê–Ω–∞–ª–∏–∑ –Ω–æ–≤—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ 1: –£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö docker-compose —Ñ–∞–π–ª–æ–≤

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- `docker-compose.yml` - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª —Å –ø—Ä–æ—Ñ–∏–ª—è–º–∏
- `docker-compose.dev.yml` - –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è DEV (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–∫—Ä–∏–ø—Ç–µ `docker:dev:separate`)
- `docker-compose.prod.yml` - –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è PROD (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–∫—Ä–∏–ø—Ç–µ `docker:prod:separate`)

**–ê–Ω–∞–ª–∏–∑:**
‚úÖ **–ü–ª—é—Å—ã —É–¥–∞–ª–µ–Ω–∏—è:**
- –£–ø—Ä–æ—â–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞
- –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –ú–µ–Ω—å—à–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü—Ä–æ—â–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –Ω–∞—Å—Ç—Ä–æ–µ–∫

‚ö†Ô∏è **–†–∏—Å–∫–∏:**
- –°–∫—Ä–∏–ø—Ç—ã `docker:dev:separate` –∏ `docker:prod:separate` —Å—Ç–∞–Ω—É—Ç –Ω–µ—Ä–∞–±–æ—á–∏–º–∏
- –ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** ‚úÖ **–£–î–ê–õ–ò–¢–¨** - –ø—Ä–æ—Ñ–∏–ª–∏ Docker Compose –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–∫—Ä—ã–≤–∞—é—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

---

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ 2: –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è Docker —Ñ–∞–π–ª–æ–≤ –≤ —Å—É–±–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

**–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
docker/
‚îú‚îÄ‚îÄ prod/
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ logs/
‚îî‚îÄ‚îÄ dev/
    ‚îú‚îÄ‚îÄ Dockerfile
    ‚îî‚îÄ‚îÄ logs/
```

**–ê–Ω–∞–ª–∏–∑:**

‚úÖ **–ü–ª—é—Å—ã:**
- –õ–æ–≥–∏—á–Ω–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è - –≤—Å–µ Docker-—Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- –õ–æ–≥–∏ —Ä—è–¥–æ–º —Å Dockerfile –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞
- –õ–µ–≥—á–µ –Ω–∞–π—Ç–∏ —Ñ–∞–π–ª—ã –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø—É –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

‚ö†Ô∏è **–í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:**

1. **Context —Å–±–æ—Ä–∫–∏:**
   - Dockerfile –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `COPY . .` –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
   - `context: .` –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –∫–æ—Ä–Ω–µ–º –ø—Ä–æ–µ–∫—Ç–∞
   - `dockerfile:` —É–∫–∞–∑—ã–≤–∞–µ—Ç –ø—É—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ context
   - ‚úÖ –†–µ—à–µ–Ω–∏–µ: `context: .` + `dockerfile: ./docker/prod/Dockerfile`

2. **–ü—É—Ç–∏ –≤ Dockerfile:**
   - –í—Å–µ –ø—É—Ç–∏ –≤ Dockerfile (COPY, WORKDIR) –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
   - Dockerfile –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –≤ –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
   - ‚úÖ –ù–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º Dockerfile –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

3. **–õ–æ–≥–∏ –≤ —Å—É–±–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ö:**
   - –õ–æ–≥–∏ —Ä—è–¥–æ–º —Å Dockerfile - —É–¥–æ–±–Ω–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
   - –õ–µ–≥—á–µ –Ω–∞–π—Ç–∏ –ª–æ–≥–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
   - ‚úÖ –•–æ—Ä–æ—à–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** ‚úÖ **–ü–†–ò–ù–Ø–¢–¨** - —É–ª—É—á—à–∞–µ—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é –ø—Ä–æ–µ–∫—Ç–∞

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

```
project/
‚îú‚îÄ‚îÄ docker/
‚îÇ   ‚îú‚îÄ‚îÄ prod/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile          # –ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logs/               # –°–æ–∑–¥–∞—Ç—å –ø—É—Å—Ç—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
‚îÇ   ‚îî‚îÄ‚îÄ dev/
‚îÇ       ‚îú‚îÄ‚îÄ Dockerfile          # –ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞ (Dockerfile.dev)
‚îÇ       ‚îî‚îÄ‚îÄ logs/               # –°–æ–∑–¥–∞—Ç—å –ø—É—Å—Ç—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
‚îú‚îÄ‚îÄ docker-compose.yml          # –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Ñ–∞–π–ª compose
‚îú‚îÄ‚îÄ .gitignore                  # –û–±–Ω–æ–≤–∏—Ç—å –¥–ª—è docker/*/logs/
‚îî‚îÄ‚îÄ package.json                # –£–¥–∞–ª–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Å–∫—Ä–∏–ø—Ç—ã
```

### 2. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ docker-compose.yml

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ:**
- `context: .` - **–ù–ï –ú–ï–ù–Ø–¢–¨**, –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –∫–æ—Ä–Ω–µ–º –ø—Ä–æ–µ–∫—Ç–∞
- `dockerfile: ./docker/prod/Dockerfile` - –ø—É—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ context
- –ü—É—Ç–∏ –∫ –ª–æ–≥–∞–º: `./docker/prod/logs` –∏ `./docker/dev/logs`

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ .gitignore

```gitignore
# Docker logs (–Ω–æ–≤—ã–µ –ø—É—Ç–∏)
docker/prod/logs/
docker/dev/logs/

# –°—Ç–∞—Ä—ã–µ –ø—É—Ç–∏ (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
logs/
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ package.json

**–£–¥–∞–ª–∏—Ç—å:**
```json
"docker:dev:separate": "docker compose -f docker-compose.dev.yml up",
"docker:prod:separate": "docker compose -f docker-compose.prod.yml up"
```

**–û—Å—Ç–∞–≤–∏—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
- –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å –ø—Ä–æ—Ñ–∏–ª—è–º–∏ –∏ –Ω–µ —Ç—Ä–µ–±—É—é—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**–§–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ Dockerfile:**
- ‚úÖ `docker-compose.yml` - –æ–±–Ω–æ–≤–∏—Ç—å –ø—É—Ç–∏
- ‚úÖ `package.json` - —É–¥–∞–ª–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Å–∫—Ä–∏–ø—Ç—ã
- ‚ö†Ô∏è `docs/DOCKER-OPTIONS.md` - –æ–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- ‚ö†Ô∏è `readme.md` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —É–ø–æ–º–∏–Ω–∞–Ω–∏—è

---

## –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: Context —Å–±–æ—Ä–∫–∏
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å `context` –Ω–∞ `./docker/prod`, —Ç–æ `COPY . .` –Ω–µ —Å–º–æ–∂–µ—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞.

**–†–µ—à–µ–Ω–∏–µ:** ‚úÖ –û—Å—Ç–∞–≤–∏—Ç—å `context: .` (–∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞), —É–∫–∞–∑–∞—Ç—å `dockerfile: ./docker/prod/Dockerfile`

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ –≤ Dockerfile
**–û–ø–∏—Å–∞–Ω–∏–µ:** Dockerfile –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ —Ç–∏–ø–∞ `COPY package*.json ./`

**–†–µ—à–µ–Ω–∏–µ:** ‚úÖ –ü—É—Ç–∏ –æ—Å—Ç–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏, —Ç–∞–∫ –∫–∞–∫ `context: .` –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Å–∫—Ä–∏–ø—Ç—ã
**–û–ø–∏—Å–∞–Ω–∏–µ:** –°–∫—Ä–∏–ø—Ç—ã `docker:dev:separate` –∏ `docker:prod:separate` –ø–µ—Ä–µ—Å—Ç–∞–Ω—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

**–†–µ—à–µ–Ω–∏–µ:** ‚úÖ –£–¥–∞–ª–∏—Ç—å —ç—Ç–∏ —Å–∫—Ä–∏–ø—Ç—ã –∏–∑ `package.json`

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
**–û–ø–∏—Å–∞–Ω–∏–µ:** –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–æ–∂–µ—Ç —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ —Å—Ç–∞—Ä—ã–µ –ø—É—Ç–∏

**–†–µ—à–µ–Ω–∏–µ:** ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å `docs/DOCKER-OPTIONS.md` –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `readme.md`

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–û–ë–ù–û–í–õ–ï–ù–û)

### –≠—Ç–∞–ø 1: –†–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
1. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π:
   ```bash
   mkdir -p docker/prod/logs
   mkdir -p docker/dev/logs
   ```

2. –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å Dockerfile —Ñ–∞–π–ª—ã:
   ```bash
   mv Dockerfile ./docker/prod/Dockerfile
   mv Dockerfile.dev ./docker/dev/Dockerfile
   ```

3. –£–¥–∞–ª–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ docker-compose —Ñ–∞–π–ª—ã:
   ```bash
   rm docker-compose.dev.yml
   rm docker-compose.prod.yml
   ```

### –≠—Ç–∞–ø 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
4. –û–±–Ω–æ–≤–∏—Ç—å `docker-compose.yml`:
   - –ò–∑–º–µ–Ω–∏—Ç—å –ø—É—Ç–∏ –∫ Dockerfile –≤ —Å–µ–∫—Ü–∏—è—Ö `build`
   - –ò–∑–º–µ–Ω–∏—Ç—å –ø—É—Ç–∏ –∫ –ª–æ–≥–∞–º –≤ —Å–µ–∫—Ü–∏—è—Ö `volumes`
   - –û–±–Ω–æ–≤–∏—Ç—å —Å–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (PROD: host, DEV: bridge)

5. –û–±–Ω–æ–≤–∏—Ç—å `.gitignore`:
   ```gitignore
   # Docker logs
   docker/prod/logs/
   docker/dev/logs/
   ```

6. –û–±–Ω–æ–≤–∏—Ç—å `package.json`:
   - –£–¥–∞–ª–∏—Ç—å —Å–∫—Ä–∏–ø—Ç—ã `docker:dev:separate` –∏ `docker:prod:separate`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å

### –≠—Ç–∞–ø 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
7. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–±–æ—Ä–∫—É –æ–±—Ä–∞–∑–æ–≤:
   ```bash
   npm run docker:build
   npm run docker:build:dev
   ```

8. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—É—Å–∫ PROD —Ä–µ–∂–∏–º–∞:
   ```bash
   npm run docker:prod
   ```

9. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—É—Å–∫ DEV —Ä–µ–∂–∏–º–∞:
   ```bash
   npm run docker:dev
   ```

10. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–æ–≤

### –≠—Ç–∞–ø 4: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
11. –û–±–Ω–æ–≤–∏—Ç—å `docs/DOCKER-OPTIONS.md` —Å –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
12. –û–±–Ω–æ–≤–∏—Ç—å `readme.md` –µ—Å–ª–∏ –µ—Å—Ç—å —É–ø–æ–º–∏–Ω–∞–Ω–∏—è Docker —Ñ–∞–π–ª–æ–≤

---

## –ê–Ω–∞–ª–∏–∑: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è DEV –∏ PROD

### –í–æ–ø—Ä–æ—Å
–ù—É–∂–Ω–æ –ª–∏ –≤–º–µ—Å—Ç–æ –æ–±—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `./config` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:
- `./docker/dev/config/` –¥–ª—è DEV —Ä–µ–∂–∏–º–∞
- `./docker/prod/config/` –¥–ª—è PROD —Ä–µ–∂–∏–º–∞

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ config:**
1. **–í docker-compose.yml:**
   - –û–±–∞ —Ä–µ–∂–∏–º–∞ –º–æ–Ω—Ç–∏—Ä—É—é—Ç `./config:/app/config`
   - DEV –∏ PROD –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–Ω—É –∏ —Ç—É –∂–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

2. **–í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:**
   - `src/main.ts` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—É—Ç—å `'./config/app.ini'`
   - –ü—É—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π, —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º volume

3. **–í —Å–∫—Ä–∏–ø—Ç–∞—Ö:**
   - `scripts/setup-config.js` —Ä–∞–±–æ—Ç–∞–µ—Ç —Å `./config/app.ini`
   - –ö–æ–ø–∏—Ä—É–µ—Ç `./config/app.ini` ‚Üí `./dist/config/app.ini` –ø—Ä–∏ —Å–±–æ—Ä–∫–µ

4. **–í Dockerfile (PROD):**
   - –ö–æ–ø–∏—Ä—É–µ—Ç `COPY --from=builder /app/config ./config` –≤ –æ–±—Ä–∞–∑
   - –ù–æ —ç—Ç–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è volume mount –≤ docker-compose.yml

5. **–í Dockerfile.dev (DEV):**
   - –ö–æ–ø–∏—Ä—É–µ—Ç `COPY . .` (–≤–∫–ª—é—á–∞—è config)
   - –ù–æ —ç—Ç–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è volume mount –≤ docker-compose.yml

### –†–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É DEV –∏ PROD

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è:**
1. **–ü–æ—Ä—Ç—ã:**
   - DEV: –ø–æ—Ä—Ç 5053 (–∏–∑ app.ini.dist)
   - PROD: –ø–æ—Ä—Ç 53 (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)

2. **Upstream DNS —Å–µ—Ä–≤–µ—Ä—ã:**
   - DEV: –º–æ–≥—É—Ç –±—ã—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–µ—Ä–≤–µ—Ä—ã
   - PROD: production —Å–µ—Ä–≤–µ—Ä—ã

3. **Hosts:**
   - DEV: dev.local, test.local
   - PROD: production –¥–æ–º–µ–Ω—ã

### –ê–Ω–∞–ª–∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

#### –í–∞—Ä–∏–∞–Ω—Ç A: –û–±—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
config/
‚îú‚îÄ‚îÄ app.ini
‚îî‚îÄ‚îÄ app.ini.dist
```

**docker-compose.yml:**
```yaml
volumes:
  - ./config:/app/config  # –î–ª—è –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–æ–≤
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ - –æ–¥–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ –õ–µ–≥–∫–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –¢–µ–∫—É—â–∏–π –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå DEV –∏ PROD –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏–º–µ—Ç—å —Ä–∞–∑–Ω—ã–µ –ø–æ—Ä—Ç—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏–º–µ—Ç—å —Ä–∞–∑–Ω—ã–µ upstream DNS
- ‚ùå –†–∏—Å–∫ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è PROD –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

**–û—Ü–µ–Ω–∫–∞:** ‚≠ê‚≠ê‚≠ê (3/5) - –†–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –≥–∏–±–∫–æ—Å—Ç—å

---

#### –í–∞—Ä–∏–∞–Ω—Ç B: –†–∞–∑–¥–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–ø—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
docker/
‚îú‚îÄ‚îÄ dev/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app.ini
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ app.ini.dist
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ logs/
‚îî‚îÄ‚îÄ prod/
    ‚îú‚îÄ‚îÄ config/
    ‚îÇ   ‚îú‚îÄ‚îÄ app.ini
    ‚îÇ   ‚îî‚îÄ‚îÄ app.ini.dist
    ‚îú‚îÄ‚îÄ Dockerfile
    ‚îî‚îÄ‚îÄ logs/
```

**docker-compose.yml:**
```yaml
dns-proxy-dev:
  volumes:
    - ./docker/dev/config:/app/config

dns-proxy-prod:
  volumes:
    - ./docker/prod/config:/app/config
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π DEV –∏ PROD
- ‚úÖ –†–∞–∑–Ω—ã–µ –ø–æ—Ä—Ç—ã (DEV: 5053, PROD: 53)
- ‚úÖ –†–∞–∑–Ω—ã–µ upstream DNS —Å–µ—Ä–≤–µ—Ä—ã
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - PROD –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ –≤–∏–¥–Ω–∞ –≤ DEV
- ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø—É —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –ø–æ —Ä–µ–∂–∏–º–∞–º
- ‚úÖ –õ–æ–≥–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (app.ini.dist)
- ‚ùå –ù—É–∂–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ app.ini.dist
- ‚ùå –¢—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ docker-compose.yml
- ‚ùå –°–∫—Ä–∏–ø—Ç setup-config.js –Ω—É–∂–Ω–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å

**–û—Ü–µ–Ω–∫–∞:** ‚≠ê‚≠ê‚≠ê‚≠ê (4/5) - –õ—É—á—à–∞—è –∏–∑–æ–ª—è—Ü–∏—è –∏ –≥–∏–±–∫–æ—Å—Ç—å

---

#### –í–∞—Ä–∏–∞–Ω—Ç C: –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
config/
‚îú‚îÄ‚îÄ app.ini.dist          # –û–±—â–∏–π —à–∞–±–ª–æ–Ω
docker/
‚îú‚îÄ‚îÄ dev/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ app.ini       # –¢–æ–ª—å–∫–æ –¥–ª—è DEV
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ logs/
‚îî‚îÄ‚îÄ prod/
    ‚îú‚îÄ‚îÄ config/
    ‚îÇ   ‚îî‚îÄ‚îÄ app.ini       # –¢–æ–ª—å–∫–æ –¥–ª—è PROD
    ‚îú‚îÄ‚îÄ Dockerfile
    ‚îî‚îÄ‚îÄ logs/
```

**–õ–æ–≥–∏–∫–∞:**
- `config/app.ini.dist` - –æ–±—â–∏–π —à–∞–±–ª–æ–Ω –≤ –∫–æ—Ä–Ω–µ
- `docker/dev/config/app.ini` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è DEV (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∏–∑ —à–∞–±–ª–æ–Ω–∞)
- `docker/prod/config/app.ini` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è PROD (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∏–∑ —à–∞–±–ª–æ–Ω–∞)

**–ü–ª—é—Å—ã:**
- ‚úÖ –û–±—â–∏–π —à–∞–±–ª–æ–Ω –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –†–∞–∑–¥–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è DEV –∏ PROD
- ‚úÖ –ò–∑–æ–ª—è—Ü–∏—è —Ä–µ–∂–∏–º–æ–≤
- ‚úÖ –õ–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —à–∞–±–ª–æ–Ω

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- ‚ùå –ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å setup-config.js –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–∞–∑–Ω—ã–º–∏ –ø—É—Ç—è–º–∏
- ‚ùå –¢—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ docker-compose.yml

**–û—Ü–µ–Ω–∫–∞:** ‚≠ê‚≠ê‚≠ê‚≠ê (4/5) - –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –ø—Ä–æ—Å—Ç–æ—Ç–æ–π –∏ –≥–∏–±–∫–æ—Å—Ç—å—é

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

### ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: –í–∞—Ä–∏–∞–Ω—Ç B (–†–∞–∑–¥–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**

1. **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ:**
   - –õ–æ–≥–∏ —É–∂–µ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –ø–æ `./docker/dev/logs/` –∏ `./docker/prod/logs/`
   - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ —Å–ª–µ–¥–æ–≤–∞—Ç—å —Ç–æ–π –∂–µ –ª–æ–≥–∏–∫–µ
   - –í—Å–µ —Ñ–∞–π–ª—ã —Ä–µ–∂–∏–º–∞ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ

2. **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
   - PROD –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Ä—Ç 53 (—Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)
   - DEV –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Ä—Ç 5053
   - –†–∞–∑–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã –¥–ª—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã

3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
   - PROD –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞ –æ—Ç DEV
   - –ù–µ—Ç —Ä–∏—Å–∫–∞ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è PROD –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

4. **–ü—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å:**
   - –õ–µ–≥–∫–æ –Ω–∞–π—Ç–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
   - –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø—É "–≤—Å–µ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ"

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ docker-compose.yml:**
```yaml
dns-proxy-dev:
  volumes:
    - ./docker/dev/config:/app/config

dns-proxy-prod:
  volumes:
    - ./docker/prod/config:/app/config
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π:**
```bash
mkdir -p docker/dev/config
mkdir -p docker/prod/config

# –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω—ã
cp config/app.ini.dist docker/dev/config/app.ini.dist
cp config/app.ini.dist docker/prod/config/app.ini.dist

# –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ —à–∞–±–ª–æ–Ω–æ–≤ (–µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç)
# setup-config.js –º–æ–∂–Ω–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
```

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ setup-config.js (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
- –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã: `setup-config-dev.js` –∏ `setup-config-prod.js`
- –ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä —Ä–µ–∂–∏–º–∞: `setup-config.js dev` / `setup-config.js prod`

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –í–∞—Ä–∏–∞–Ω—Ç C (–ì–∏–±—Ä–∏–¥–Ω—ã–π)

–ï—Å–ª–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ `app.ini.dist` –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –í–∞—Ä–∏–∞–Ω—Ç C:
- –û–±—â–∏–π —à–∞–±–ª–æ–Ω –≤ `config/app.ini.dist`
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ `docker/dev/config/app.ini` –∏ `docker/prod/config/app.ini`
- –°–∫—Ä–∏–ø—Ç setup-config.js –æ–±–Ω–æ–≤–∏—Ç—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–∞–∑–Ω—ã–º–∏ –ø—É—Ç—è–º–∏

---

## üé®üé®üé® EXITING CREATIVE PHASE

---

## ‚úÖ –§–ò–ù–ê–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï (–ü–†–ò–ù–Ø–¢–û)

### –í—ã–±—Ä–∞–Ω–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã

1. **Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** –í–∞—Ä–∏–∞–Ω—Ç 1 (–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ)
   - PROD: `network_mode: host` + –ø–æ—Ä—Ç 53 + `cap_add: NET_BIND_SERVICE`
   - DEV: bridge network + –ø–æ—Ä—Ç mapping `53:5053` + –±–µ–∑ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π

2. **–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤:**
   - Dockerfile —Ñ–∞–π–ª—ã –≤ `./docker/prod/Dockerfile` –∏ `./docker/dev/Dockerfile`
   - –õ–æ–≥–∏ –≤ `./docker/prod/logs/` –∏ `./docker/dev/logs/`

3. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** –í–∞—Ä–∏–∞–Ω—Ç B (–†–∞–∑–¥–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏) ‚úÖ **–ü–†–ò–ù–Ø–¢–û**
   - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ `./docker/dev/config/` –∏ `./docker/prod/config/`
   - –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è DEV –∏ PROD —Ä–µ–∂–∏–º–æ–≤

### –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–û–ë–ù–û–í–õ–ï–ù–û)

```
project/
‚îú‚îÄ‚îÄ env/                         # –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–æ –∏–∑ "docker"
‚îÇ   ‚îú‚îÄ‚îÄ prod/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app.ini         # –°–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏–∑ app.ini.dist
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ app.ini.dist
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logs/
‚îÇ   ‚îî‚îÄ‚îÄ dev/
‚îÇ       ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ       ‚îú‚îÄ‚îÄ config/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ app.ini         # –°–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏–∑ app.ini.dist
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ app.ini.dist
‚îÇ       ‚îî‚îÄ‚îÄ logs/
‚îú‚îÄ‚îÄ docker-compose.yml          # –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Ñ–∞–π–ª compose
‚îî‚îÄ‚îÄ ...
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ –ü–∞–ø–∫–∞ `docker/` –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∞ –≤ `env/`
- ‚úÖ –°–∫—Ä–∏–ø—Ç `setup-config.js` —É–¥–∞–ª–µ–Ω
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º —Å–æ–∑–¥–∞–µ—Ç `app.ini` –∏–∑ `app.ini.dist`
- ‚úÖ –ü—É—Ç—å –∫ `app.ini` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `APP_INI_PATH`

### –ö–ª—é—á–µ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è

1. **Context —Å–±–æ—Ä–∫–∏:** `context: .` –æ—Å—Ç–∞–µ—Ç—Å—è –∫–æ—Ä–Ω–µ–º –ø—Ä–æ–µ–∫—Ç–∞
2. **–°–µ—Ç–µ–≤—ã–µ —Ä–µ–∂–∏–º—ã:** PROD –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `host`, DEV –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `bridge`
3. **–ü–æ—Ä—Ç—ã:** PROD –Ω–∞ 53, DEV –Ω–∞ 5053
4. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:** –ü–æ–ª–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –∏ —Ä–∞–∑–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
5. **–õ–æ–≥–∏:** –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ä–µ–∂–∏–º–∞–º –≤ —Å—É–±–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ö
6. **–ù–∞–∑–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:** `env/` –≤–º–µ—Å—Ç–æ `docker/` (–û–ë–ù–û–í–õ–ï–ù–û)
7. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π:** –£–¥–∞–ª–µ–Ω `setup-config.js`, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º —Å–æ–∑–¥–∞–µ—Ç `app.ini` (–û–ë–ù–û–í–õ–ï–ù–û)
8. **–ü—É—Ç—å –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:** –ü–µ—Ä–µ–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `APP_INI_PATH` (–û–ë–ù–û–í–õ–ï–ù–û)

### –û—Ü–µ–Ω–∫–∞

**–û—Ü–µ–Ω–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:** –°—Ä–µ–¥–Ω—è—è  
**–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** 2-3 —á–∞—Å–∞  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ—à–µ–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–æ, –≥–æ—Ç–æ–≤–æ –∫ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—é

---

## –ù–æ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (–û–ë–ù–û–í–õ–ï–ù–û)

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ 1: –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** `docker/` ‚Üí `env/`

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- –ë–æ–ª–µ–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (–Ω–µ —Ç–æ–ª—å–∫–æ Docker, –Ω–æ –∏ –æ–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è)
- –õ—É—á—à–µ –æ—Ç—Ä–∞–∂–∞–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ (–æ–∫—Ä—É–∂–µ–Ω–∏—è DEV –∏ PROD)

**–í–ª–∏—è–Ω–∏–µ:**
- –í—Å–µ –ø—É—Ç–∏ –≤ docker-compose.yml: `./docker/...` ‚Üí `./env/...`
- –í—Å–µ –ø—É—Ç–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ .gitignore

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ 2: –£–¥–∞–ª–µ–Ω–∏–µ setup-config.js
**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –£–¥–∞–ª–∏—Ç—å —Å–∫—Ä–∏–ø—Ç `scripts/setup-config.js`

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- –£–ø—Ä–æ—â–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –ú–µ–Ω—å—à–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ = –±–æ–ª—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—è

**–í–ª–∏—è–Ω–∏–µ:**
- –£–¥–∞–ª–∏—Ç—å –≤—ã–∑–æ–≤—ã `node scripts/setup-config.js setup` –∏–∑:
  - `docker-compose.yml` (command)
  - `Dockerfile.dev` (CMD)
  - `package.json` (—Å–∫—Ä–∏–ø—Ç—ã: dev, dev:debug, build, start, prod:tsx, docker:dev:debug)
- –£–¥–∞–ª–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –∏–∑ —Å–±–æ—Ä–∫–∏: `npm run build` –±–æ–ª—å—à–µ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç setup-config.js
- –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ 3: –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è APP_INI_PATH
**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –ü—É—Ç—å –∫ `app.ini` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `APP_INI_PATH`

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- `src/main.ts` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—É—Ç—å `'./config/app.ini'`

**–¢—Ä–µ–±—É–µ–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
1. –û–±–Ω–æ–≤–∏—Ç—å `src/main.ts`:
   ```typescript
   const iniPath = process.env.APP_INI_PATH || './config/app.ini';
   loadFromIni(iniPath).then(...)
   ```

2. –û–±–Ω–æ–≤–∏—Ç—å `docker-compose.yml`:
   ```yaml
   environment:
     - APP_INI_PATH=/app/config/app.ini  # –∏–ª–∏ –ø—É—Ç—å –∫ env/prod/config/app.ini
   ```

3. –û–±–Ω–æ–≤–∏—Ç—å `.run-dev.env` –∏ `.run-prod.env`:
   ```env
   APP_INI_PATH=./env/dev/config/app.ini
   APP_INI_PATH=./env/prod/config/app.ini
   ```

**–í–ª–∏—è–Ω–∏–µ:**
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤ –∫–æ–¥–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (src/main.ts)
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ docker-compose.yml
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
project/
‚îú‚îÄ‚îÄ env/                         # –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–æ –∏–∑ "docker"
‚îÇ   ‚îú‚îÄ‚îÄ prod/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app.ini         # –°–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ app.ini.dist    # –®–∞–±–ª–æ–Ω
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logs/
‚îÇ   ‚îî‚îÄ‚îÄ dev/
‚îÇ       ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ       ‚îú‚îÄ‚îÄ config/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ app.ini         # –°–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ app.ini.dist    # –®–∞–±–ª–æ–Ω
‚îÇ       ‚îî‚îÄ‚îÄ logs/
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ setup-config.js         # –£–î–ê–õ–ò–¢–¨
‚îî‚îÄ‚îÄ src/
    ‚îî‚îÄ‚îÄ main.ts                  # –ò–ó–ú–ï–ù–ò–¢–¨: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å APP_INI_PATH
```

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø—É—Ç–∏ –≤ docker-compose.yml

```yaml
dns-proxy-prod:
  build:
    dockerfile: ./env/prod/Dockerfile
  volumes:
    - ./env/prod/config:/app/config
    - ./env/prod/logs:/app/logs
  environment:
    - APP_INI_PATH=/app/config/app.ini

dns-proxy-dev:
  build:
    dockerfile: ./env/dev/Dockerfile
  volumes:
    - ./env/dev/config:/app/config
    - ./env/dev/logs:/app/logs
  environment:
    - APP_INI_PATH=/app/config/app.ini
```

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

**–ë—ã–ª–æ:**
```yaml
command: sh -c "node scripts/setup-config.js setup && node dist/app.js"
```

**–°—Ç–∞–ª–æ:**
```yaml
command: node dist/app.js
# –∏–ª–∏
command: npx tsx --inspect src/main.ts
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ package.json

**–£–¥–∞–ª–∏—Ç—å –∏–∑ —Å–∫—Ä–∏–ø—Ç–æ–≤:**
- `node scripts/setup-config.js setup` –∏–∑ –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥
- `node scripts/setup-config.js build` –∏–∑ –∫–æ–º–∞–Ω–¥—ã build

**–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:**
```json
{
  "dev": "node scripts/load-env-and-run.js .run-dev.env 'tsx --inspect src/main.ts'",
  "dev:debug": "tsx --inspect-brk src/main.ts",
  "build": "node scripts/clean-dist.js && node scripts/build-dependencies.js && node scripts/build-app.js",
  "start": "cd dist && node app.js",
  "docker:dev:debug": "docker compose --profile dev run --rm dns-proxy-dev sh -c 'npx tsx --inspect-brk src/main.ts'"
}
```

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ app.ini:**
   - **–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å–æ–∑–¥–∞–ª app.ini, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É–ø–∞–¥–µ—Ç
   - **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤ –∫–æ–¥ –∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

2. **–ü—É—Ç—å –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
   - **–ü—Ä–æ–±–ª–µ–º–∞:** –ù—É–∂–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É–∫–∞–∑–∞—Ç—å APP_INI_PATH –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤
   - **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –ø—É—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ (`/app/config/app.ini`)

3. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
   - **–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ç–∞—Ä—ã–π –∫–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—É—Ç—å
   - **–†–µ—à–µ–Ω–∏–µ:** –û—Å—Ç–∞–≤–∏—Ç—å fallback –Ω–∞ `'./config/app.ini'` –µ—Å–ª–∏ APP_INI_PATH –Ω–µ –∑–∞–¥–∞–Ω

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–û–±–Ω–æ–≤–∏—Ç—å src/main.ts:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `process.env.APP_INI_PATH` —Å fallback
   - –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞

2. **–û–±–Ω–æ–≤–∏—Ç—å docker-compose.yml:**
   - –ò–∑–º–µ–Ω–∏—Ç—å –≤—Å–µ –ø—É—Ç–∏ —Å `docker/` –Ω–∞ `env/`
   - –£–±—Ä–∞—Ç—å –≤—ã–∑–æ–≤—ã setup-config.js
   - –î–æ–±–∞–≤–∏—Ç—å APP_INI_PATH –≤ environment

3. **–û–±–Ω–æ–≤–∏—Ç—å .run-dev.env –∏ .run-prod.env:**
   - –î–æ–±–∞–≤–∏—Ç—å `APP_INI_PATH`

4. **–£–¥–∞–ª–∏—Ç—å setup-config.js:**
   - –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª
   - –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å—Å—ã–ª–∫–∏

5. **–û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é:**
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é app.ini
   - –û–ø–∏—Å–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π APP_INI_PATH
