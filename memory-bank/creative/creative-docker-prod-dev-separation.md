# Creative Phase: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è PROD –∏ DEV —Ä–µ–∂–∏–º–æ–≤

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2026-01-16  
**–¢–∏–ø:** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ  
**–°—Ç–∞—Ç—É—Å:** üé® CREATIVE PHASE

---

## üé®üé®üé® ENTERING CREATIVE PHASE: ARCHITECTURE

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

#### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
1. **PROD —Ä–µ–∂–∏–º:**
   - –ë–∏–Ω–¥–∏—Ç—å –ø–æ—Ä—Ç 53 –Ω–∞ —Ö–æ—Å—Ç-–º–∞—à–∏–Ω–µ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π DNS –ø–æ—Ä—Ç)
   - –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞–ø–∫—É `./volume/prod/logs/` –≤ `/app/logs`
   - –†–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π DNS-–ø—Ä–æ–∫—Å–∏ —Å–µ—Ä–≤–µ—Ä

2. **DEV —Ä–µ–∂–∏–º:**
   - –ë–∏–Ω–¥–∏—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Ä—Ç 53 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–∞ –≤–Ω–µ—à–Ω–∏–π –ø–æ—Ä—Ç 5053 —Ö–æ—Å—Ç–∞
   - –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞–ø–∫—É `./volume/dev/logs/` –≤ `/app/logs`
   - –ü–æ–∑–≤–æ–ª—è—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å PROD

3. **–û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞:**
   - PROD –∏ DEV –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
   - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ (–ø–æ—Ä—Ç—ã, –ª–æ–≥–∏, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)

#### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –ü–æ—Ä—Ç 53 —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π `NET_BIND_SERVICE` (Linux capability)
- DNS —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ UDP –ø—Ä–æ—Ç–æ–∫–æ–ª—É
- –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `network_mode: host` –¥–ª—è –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–æ–≤
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `config/app.ini` (–ø–æ—Ä—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 53 –≤ –∫–æ–¥–µ, 5053 –≤ –∫–æ–Ω—Ñ–∏–≥–µ)

#### –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Docker Compose —Å –ø—Ä–æ—Ñ–∏–ª—è–º–∏ (`dev` –∏ `prod`)
- PROD –∏—Å–ø–æ–ª—å–∑—É–µ—Ç multi-stage build (Dockerfile)
- DEV –∏—Å–ø–æ–ª—å–∑—É–µ—Ç development build (Dockerfile.dev)
- –û–±–∞ –æ–±—Ä–∞–∑–∞ –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ `node:20.17-alpine`

---

## –ê–Ω–∞–ª–∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
1. **PROD:** `network_mode: host` + –ø–æ—Ä—Ç 53 + `./volume/prod/logs/`
2. **DEV:** bridge network + –ø–æ—Ä—Ç 53‚Üí5053 + `./volume/dev/logs/`

### –ü–ª—é—Å—ã –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è
‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏** - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏  
‚úÖ **–ò–∑–æ–ª—è—Ü–∏—è DEV** - DEV –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π, —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º –ø–æ—Ä—Ç—É  
‚úÖ **PROD –æ—Å—Ç–∞–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π DNS –ø–æ—Ä—Ç 53  
‚úÖ **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–æ–≤** - —á–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–æ–≤ –ø–æ —Ä–µ–∂–∏–º–∞–º  
‚úÖ **–û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞** - –Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø–æ—Ä—Ç–æ–≤ –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏  

### –ú–∏–Ω—É—Å—ã –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è
‚ùå **–†–∞–∑–Ω—ã–µ —Å–µ—Ç–µ–≤—ã–µ —Ä–µ–∂–∏–º—ã** - PROD –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `host`, DEV –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `bridge` (—Ä–∞–∑–Ω–∞—è —Å–µ—Ç–µ–≤–∞—è –∏–∑–æ–ª—è—Ü–∏—è)  
‚ùå **–†–∞–∑–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ç–∏** - –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Ä–∞–∑–ª–∏—á–∏—è–º –≤ –ø–æ–≤–µ–¥–µ–Ω–∏–∏  
‚ùå **–¢—Ä–µ–±—É–µ—Ç –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π –¥–ª—è PROD** - –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ `cap_add: NET_BIND_SERVICE`  
‚ùå **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å firewall** - –ø—Ä–∏ `network_mode: host` –æ–±—Ö–æ–¥—è—Ç—Å—è –ø—Ä–∞–≤–∏–ª–∞ Docker firewall  

---

## –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—à–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- PROD: `network_mode: host` + –ø–æ—Ä—Ç 53 + `cap_add: NET_BIND_SERVICE`
- DEV: bridge network + –ø–æ—Ä—Ç mapping `53:5053` + –±–µ–∑ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```yaml
# docker-compose.yml
services:
  dns-proxy-prod:
    profiles: [prod]
    network_mode: host
    volumes:
      - ./volume/prod/logs:/app/logs
    cap_add:
      - NET_BIND_SERVICE

  dns-proxy-dev:
    profiles: [dev]
    ports:
      - "5053:53/udp"
    volumes:
      - ./volume/dev/logs:/app/logs
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- ‚úÖ PROD —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º –ø–æ—Ä—Ç—É
- ‚úÖ DEV –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π
- ‚úÖ –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –†–∞–∑–Ω—ã–µ —Å–µ—Ç–µ–≤—ã–µ —Ä–µ–∂–∏–º—ã (host vs bridge)
- ‚ùå PROD —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π
- ‚ùå –†–∞–∑–Ω–æ–µ —Å–µ—Ç–µ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

**–û—Ü–µ–Ω–∫–∞:** ‚≠ê‚≠ê‚≠ê‚≠ê (4/5)

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: Bridge network –¥–ª—è –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–æ–≤

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- PROD: bridge network + –ø–æ—Ä—Ç mapping `53:53` + `cap_add: NET_BIND_SERVICE`
- DEV: bridge network + –ø–æ—Ä—Ç mapping `53:5053` + –±–µ–∑ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```yaml
# docker-compose.yml
services:
  dns-proxy-prod:
    profiles: [prod]
    ports:
      - "53:53/udp"
    volumes:
      - ./volume/prod/logs:/app/logs
    cap_add:
      - NET_BIND_SERVICE

  dns-proxy-dev:
    profiles: [dev]
    ports:
      - "5053:53/udp"
    volumes:
      - ./volume/dev/logs:/app/logs
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ï–¥–∏–Ω—ã–π —Å–µ—Ç–µ–≤–æ–π —Ä–µ–∂–∏–º –¥–ª—è –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–æ–≤
- ‚úÖ –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Å–µ—Ç–µ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
- ‚úÖ –ò–∑–æ–ª—è—Ü–∏—è —á–µ—Ä–µ–∑ Docker network
- ‚úÖ –õ–µ–≥—á–µ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å —Å–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå PROD –≤—Å–µ —Ä–∞–≤–Ω–æ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π –¥–ª—è –ø–æ—Ä—Ç–∞ 53
- ‚ùå –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å —Å–µ—Ç–µ–≤–æ–π –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ (–º–æ–∂–µ—Ç –≤–ª–∏—è—Ç—å –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
- ‚ùå –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å firewall –ø—Ä–∞–≤–∏–ª–∞–º–∏

**–û—Ü–µ–Ω–∫–∞:** ‚≠ê‚≠ê‚≠ê‚≠ê (4/5)

---

### –í–∞—Ä–∏–∞–Ω—Ç 3: –û—Ç–¥–µ–ª—å–Ω—ã–µ docker-compose —Ñ–∞–π–ª—ã

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã: `docker-compose.prod.yml` –∏ `docker-compose.dev.yml`
- –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–∑–∞–≤–∏—Å–∏–º
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—â–∏–π `docker-compose.yml` —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–±—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```yaml
# docker-compose.prod.yml
services:
  dns-proxy-prod:
    network_mode: host
    volumes:
      - ./volume/prod/logs:/app/logs
    cap_add:
      - NET_BIND_SERVICE

# docker-compose.dev.yml
services:
  dns-proxy-dev:
    ports:
      - "5053:53/udp"
    volumes:
      - ./volume/dev/logs:/app/logs
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
- ‚úÖ –õ–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ä–µ–∂–∏–º—ã
- ‚úÖ –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏
- ‚úÖ –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –æ–±—Ä–∞–∑–æ–≤

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚ùå –°–ª–æ–∂–Ω–µ–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
- ‚ùå –ë–æ–ª—å—à–µ —Ñ–∞–π–ª–æ–≤ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–û—Ü–µ–Ω–∫–∞:** ‚≠ê‚≠ê‚≠ê (3/5)

---

### –í–∞—Ä–∏–∞–Ω—Ç 4: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—Ä—Ç–æ–≤ –∏ –ø—É—Ç–µ–π
- –ï–¥–∏–Ω—ã–π docker-compose —Ñ–∞–π–ª —Å —É—Å–ª–æ–≤–Ω–æ–π –ª–æ–≥–∏–∫–æ–π
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ `.env` —Ñ–∞–π–ª—ã

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```yaml
# docker-compose.yml
services:
  dns-proxy-prod:
    profiles: [prod]
    network_mode: ${PROD_NETWORK_MODE:-host}
    ports:
      - "${PROD_HOST_PORT:-53}:${PROD_CONTAINER_PORT:-53}/udp"
    volumes:
      - ${PROD_LOGS_PATH:-./volume/prod/logs}:/app/logs
    cap_add:
      - NET_BIND_SERVICE
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ì–∏–±–∫–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚úÖ –ï–¥–∏–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ –õ–µ–≥–∫–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –°–ª–æ–∂–Ω–µ–µ –ø–æ–Ω—è—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- ‚ùå –¢—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- ‚ùå –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

**–û—Ü–µ–Ω–∫–∞:** ‚≠ê‚≠ê‚≠ê (3/5)

---

## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –í—ã–±–æ—Ä: –í–∞—Ä–∏–∞–Ω—Ç 1 (–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ) —Å —É–ª—É—á—à–µ–Ω–∏—è–º–∏

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
1. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** - –ø—Ä–æ—â–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å
2. **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º** - –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
3. **–ü—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å** - PROD –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º –ø–æ—Ä—Ç—É, DEV –Ω–∞ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º
4. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–æ–≤** - —á–µ—Ç–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫

**–£–ª—É—á—à–µ–Ω–∏—è:**
1. –î–æ–±–∞–≤–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –¥–ª—è –ª–æ–≥–æ–≤ –≤ `.gitignore`
2. –î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
3. –û–±–Ω–æ–≤–∏—Ç—å npm —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∑–∞–ø—É—Å–∫–∞
4. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–æ—Ä—Ç–æ–≤ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

---

## –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
```
project/
‚îú‚îÄ‚îÄ volume/
‚îÇ   ‚îú‚îÄ‚îÄ prod/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logs/
‚îÇ   ‚îî‚îÄ‚îÄ dev/
‚îÇ       ‚îî‚îÄ‚îÄ logs/
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ Dockerfile
‚îî‚îÄ‚îÄ Dockerfile.dev
```

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ docker-compose.yml

**PROD —Å–µ—Ä–≤–∏—Å:**
```yaml
dns-proxy-prod:
  profiles: [prod]
  network_mode: host
  volumes:
    - ./volume/prod/logs:/app/logs
  cap_add:
    - NET_BIND_SERVICE
```

**DEV —Å–µ—Ä–≤–∏—Å:**
```yaml
dns-proxy-dev:
  profiles: [dev]
  ports:
    - "5053:53/udp"
  volumes:
    - ./volume/dev/logs:/app/logs
  # cap_add –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ npm —Å–∫—Ä–∏–ø—Ç–æ–≤
```json
{
  "docker:prod": "docker compose --profile prod up dns-proxy-prod",
  "docker:dev": "docker compose --profile dev up dns-proxy-dev",
  "docker:both": "docker compose --profile prod --profile dev up"
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
- ‚úÖ PROD –±–∏–Ω–¥–∏—Ç –ø–æ—Ä—Ç 53 –Ω–∞ —Ö–æ—Å—Ç-–º–∞—à–∏–Ω–µ
- ‚úÖ PROD –º–æ–Ω—Ç–∏—Ä—É–µ—Ç `./volume/prod/logs/` –≤ `/app/logs`
- ‚úÖ DEV –±–∏–Ω–¥–∏—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Ä—Ç 53 –Ω–∞ –≤–Ω–µ—à–Ω–∏–π 5053
- ‚úÖ DEV –º–æ–Ω—Ç–∏—Ä—É–µ—Ç `./volume/dev/logs/` –≤ `/app/logs`
- ‚úÖ –û–±–∞ —Ä–µ–∂–∏–º–∞ –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

---

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ iptables –¥–ª—è –ø—Ä–æ–±—Ä–æ—Å–∞ –ø–æ—Ä—Ç–æ–≤
–í–º–µ—Å—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å iptables –¥–ª—è –ø—Ä–æ–±—Ä–æ—Å–∞ –ø–æ—Ä—Ç–∞ 53 –Ω–∞ 5053 –≤ DEV —Ä–µ–∂–∏–º–µ. –û–¥–Ω–∞–∫–æ —ç—Ç–æ:
- ‚ùå –¢—Ä–µ–±—É–µ—Ç root –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π
- ‚ùå –£—Å–ª–æ–∂–Ω—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É
- ‚ùå –ú–µ–Ω–µ–µ –ø–µ—Ä–µ–Ω–æ—Å–∏–º–æ –º–µ–∂–¥—É —Å–∏—Å—Ç–µ–º–∞–º–∏

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ systemd –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å systemd –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è PROD –∏ DEV –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏. –û–¥–Ω–∞–∫–æ —ç—Ç–æ:
- ‚ùå –¢—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚ùå –ú–µ–Ω–µ–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–æ
- ‚ùå –°–ª–æ–∂–Ω–µ–µ —É–ø—Ä–∞–≤–ª—è—Ç—å —á–µ—Ä–µ–∑ Docker

---

## –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

### –†–∏—Å–∫ 1: –ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ—Ä—Ç–æ–≤
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ï—Å–ª–∏ PROD —É–∂–µ –∑–∞–ø—É—â–µ–Ω, DEV –Ω–µ —Å–º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Ä—Ç 53  
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** DEV –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ä—Ç 5053, –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –Ω–µ—Ç

### –†–∏—Å–∫ 2: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π –¥–ª—è PROD
**–û–ø–∏—Å–∞–Ω–∏–µ:** PROD —Ç—Ä–µ–±—É–µ—Ç `NET_BIND_SERVICE` –¥–ª—è –ø–æ—Ä—Ç–∞ 53  
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –£–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ `cap_add`

### –†–∏—Å–∫ 3: –†–∞–∑–Ω—ã–µ —Å–µ—Ç–µ–≤—ã–µ —Ä–µ–∂–∏–º—ã
**–û–ø–∏—Å–∞–Ω–∏–µ:** PROD –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `host`, DEV –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `bridge`  
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –≠—Ç–æ –æ–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º

### –†–∏—Å–∫ 4: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –¥–ª—è –ª–æ–≥–æ–≤
**–û–ø–∏—Å–∞–Ω–∏–µ:** –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `./volume/prod/logs/` –∏ `./volume/dev/logs/` –º–æ–≥—É—Ç –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å  
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** Docker —Å–æ–∑–¥–∞—Å—Ç –∏—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏, –Ω–æ –ª—É—á—à–µ –¥–æ–±–∞–≤–∏—Ç—å –≤ `.gitignore`

---

## –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

- ‚úÖ PROD –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 53 –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ DEV –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 5053 –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –û–±–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- ‚úÖ –õ–æ–≥–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –ø–æ –ø–∞–ø–∫–∞–º `volume/prod/logs/` –∏ `volume/dev/logs/`
- ‚úÖ –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø–æ—Ä—Ç–æ–≤
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤ –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–∞—Ö

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `docker-compose.yml`
2. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π `volume/prod/logs/` –∏ `volume/dev/logs/`
3. –û–±–Ω–æ–≤–∏—Ç—å `.gitignore` –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ª–æ–≥–æ–≤
4. –û–±–Ω–æ–≤–∏—Ç—å npm —Å–∫—Ä–∏–ø—Ç—ã
5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—É—Å–∫ PROD –∏ DEV —Ä–µ–∂–∏–º–æ–≤
6. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–æ–≤
7. –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

---

## üé®üé®üé® EXITING CREATIVE PHASE

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ:** –í–∞—Ä–∏–∞–Ω—Ç 1 (–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ)  
**–û—Ü–µ–Ω–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:** –ù–∏–∑–∫–∞—è  
**–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** 1-2 —á–∞—Å–∞  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π
